# Biology Tutorial Workflow

åŸºäº LangChain çš„é«˜ä¸‰ç”Ÿç‰©é”™é¢˜è¾…å¯¼åç«¯æœåŠ¡ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸ–¼ï¸ **è§†è§‰ç†è§£**: ä»é”™é¢˜å›¾ç‰‡ä¸­æå–é¢˜å¹²
- ğŸ§  **æ·±åº¦è§£ç­”**: ä½¿ç”¨æ·±åº¦æ€è€ƒæ¨¡å‹ç”Ÿæˆè¯¦ç»†è§£ç­”
- âš¡ **å¿«é€Ÿæ€»ç»“**: å¿«é€Ÿæå–è€ƒå¯Ÿç‚¹å’ŒçŸ¥è¯†ç‚¹
- ğŸ’¬ **æ¸©æŸ”äººè®¾**: æ¸©æŸ”å¤§å§å§é£æ ¼çš„è¾…å¯¼ä½“éªŒ
- ğŸ”„ **å¼‚æ­¥å¹¶è¡Œ**: è€—æ—¶ä»»åŠ¡åå°æ‰§è¡Œï¼Œå®æ—¶å“åº”ç”¨æˆ·
- ğŸ“¡ **SSE æ¨é€**: å®æ—¶é€šçŸ¥ä»»åŠ¡å®ŒæˆçŠ¶æ€

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd TutorialChat_backend
pip install -r requirements.txt
```

### 2. é…ç½®

å¤åˆ¶é…ç½®æ–‡ä»¶å¹¶å¡«å…¥ API å¯†é’¥ï¼š

```bash
cp settings.example.yaml settings.yaml
```

ç¼–è¾‘ `settings.yaml`ï¼Œé…ç½®ä½ çš„æ¨¡å‹ API å¯†é’¥ï¼š

```yaml
vision_model:
  provider: doubao
  model_name: doubao-1.6-vision
  api_key: your-api-key-here
```

æˆ–è€…ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼š

```bash
export DOUBAO_API_KEY=your-api-key-here
```

### 3. å¯åŠ¨æœåŠ¡

```bash
python main.py
```

æˆ–ä½¿ç”¨ uvicornï¼š

```bash
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

## API æ¥å£

### åˆ›å»ºä¼šè¯

```http
POST /api/session
```

å“åº”ï¼š
```json
{
  "session_id": "uuid",
  "greeting": "ä½ å¥½å‘€~ æˆ‘æ˜¯ä½ çš„ç”Ÿç‰©è¾…å¯¼å§å§..."
}
```

### ä¸Šä¼ å›¾ç‰‡

```http
POST /api/session/{session_id}/image
Content-Type: multipart/form-data

file: <image_file>
```

### å‘é€æ¶ˆæ¯

```http
POST /api/session/{session_id}/message
Content-Type: application/json

{
  "content": "ç”¨æˆ·æ¶ˆæ¯å†…å®¹"
}
```

### è®¢é˜…äº‹ä»¶ (SSE)

```http
GET /api/session/{session_id}/events
```

äº‹ä»¶ç±»å‹ï¼š
- `question_extracted` - é¢˜å¹²æå–å®Œæˆ
- `exam_points_ready` - è€ƒå¯Ÿç‚¹æ€»ç»“å®Œæˆ
- `solution_ready` - è¯¦ç»†è§£ç­”å®Œæˆ
- `knowledge_ready` - çŸ¥è¯†ç‚¹æ¢³ç†å®Œæˆ
- `logic_chain_ready` - è§£é¢˜é€»è¾‘é“¾å®Œæˆ
- `task_failed` - ä»»åŠ¡å¤±è´¥
- `session_complete` - ä¼šè¯å®Œæˆ

### æŸ¥è¯¢çŠ¶æ€

```http
GET /api/session/{session_id}/status
```

## é¡¹ç›®ç»“æ„

```
TutorialChat_backend/
â”œâ”€â”€ main.py              # FastAPI åº”ç”¨å…¥å£
â”œâ”€â”€ settings.yaml        # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt     # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ api/
â”‚   â””â”€â”€ routes.py        # API è·¯ç”±
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.py      # é…ç½®ç®¡ç†
â”œâ”€â”€ models/
â”‚   â””â”€â”€ api_models.py    # API æ•°æ®æ¨¡å‹
â”œâ”€â”€ session/
â”‚   â”œâ”€â”€ models.py        # ä¼šè¯æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ manager.py       # ä¼šè¯ç®¡ç†å™¨
â”œâ”€â”€ sse/
â”‚   â””â”€â”€ publisher.py     # SSE äº‹ä»¶å‘å¸ƒ
â”œâ”€â”€ workflow/
â”‚   â”œâ”€â”€ biology_tutor.py # ä¸» Workflow
â”‚   â”œâ”€â”€ model_factory.py # æ¨¡å‹å·¥å‚
â”‚   â””â”€â”€ chains/          # LangChain Chains
â”œâ”€â”€ prompts/             # Prompt æ¨¡æ¿
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ errors.py        # é”™è¯¯å¤„ç†
â”‚   â””â”€â”€ retry.py         # é‡è¯•æœºåˆ¶
â””â”€â”€ tests/               # æµ‹è¯•æ–‡ä»¶
```

## ä»»åŠ¡æ‰§è¡Œæµç¨‹

```
ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                              â”‚
    â–¼                              â–¼
è¯¢é—®æ€è€ƒè¿‡ç¨‹              è§†è§‰ç†è§£æå–é¢˜å¹² (åå°)
    â”‚                              â”‚
    â–¼                              â”‚
ç”¨æˆ·å›å¤                           â”‚
    â”‚                              â”‚
    â–¼                              â”‚
è¯¢é—®è¾…å¯¼æ–¹å¼                       â”‚
    â”‚                              â–¼
    â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚                   â”‚
    â”‚                    â–¼                   â–¼
    â”‚            å¿«é€Ÿè€ƒå¯Ÿç‚¹æ€»ç»“      æ·±åº¦æ€è€ƒè§£ç­” (åå°)
    â”‚                    â”‚                   â”‚
    â”‚                    â”‚                   â–¼
    â”‚                    â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚         â”‚                   â”‚
    â”‚                    â”‚         â–¼                   â–¼
    â”‚                    â”‚   çŸ¥è¯†ç‚¹æ¢³ç†          é€»è¾‘é“¾æ¢³ç†
    â”‚                    â”‚         â”‚                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
                            è¾“å‡ºè¾…å¯¼ç»“æœ
```

## å‰ç«¯é›†æˆ

å‚è€ƒ `TutorialChat` å‰ç«¯é¡¹ç›®ï¼Œä½¿ç”¨ä»¥ä¸‹æ–¹å¼é›†æˆï¼š

1. åˆ›å»ºä¼šè¯è·å– `session_id`
2. å»ºç«‹ SSE è¿æ¥ç›‘å¬ä»»åŠ¡çŠ¶æ€
3. ä¸Šä¼ å›¾ç‰‡å¼€å§‹åˆ†æ
4. é€šè¿‡æ¶ˆæ¯ API è¿›è¡Œå¯¹è¯
5. æ ¹æ® SSE äº‹ä»¶æ›´æ–° UI

## License

MIT
